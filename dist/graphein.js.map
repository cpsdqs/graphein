{"version":3,"sources":["webpack:///webpack/bootstrap 70634ce2f86c6d617ccb","webpack:///./src/layer.js","webpack:///./src/image.js","webpack:///./src/transform.js","webpack:///./src/index.js","webpack:///./src/canvas.js","webpack:///./src/path.js","webpack:///./src/color.js","webpack:///./src/brush.js","webpack:///./node_modules/events/events.js"],"names":["Transform","require","module","exports","Layer","constructor","type","types","GROUP","transform","children","serialize","map","child","render","ctx","save","forEach","restore","PATH","CLIPPING_MASK","RECTANGLE","CIRCLE","TEXT","RASTER_IMAGE","Image","version","width","height","w","h","c","clearRect","beginPath","rect","clip","NONE","data","Float32Array","MAT3","MAT4","console","warn","deserialize","length","slice","Canvas","Path","graphein","window","Brush","HTMLElement","canvas","document","createElement","getContext","brush","bind","_image","previewLayer","on","connectedCallback","_didInit","appendChild","image","v","start","performance","now","end","log","customElements","define","Color","basePath","createElementNS","widthL","widthR","StrokeRenderer","path","cursor","cursorL","cursorR","add","args","startsWith","substr","push","leftArgs","concat","rightArgs","getPath","item","join","getWidthL","getWidthR","setAttribute","baseLength","getTotalLength","resolution","devicePixelRatio","currentL","currentR","findNextPointAtX","target","x","getPointAtLength","lastLeftPos","lastRightPos","point","leftPos","rightPos","left","y","right","moveTo","stroke","lineWidth","lineTo","instructionFunctions","Instruction","renderer","CLOSE_PATH","MOVE","MOVE_R","LINE","LINE_R","CUBIC_BEZIER","CUBIC_BEZIER_R","CUBIC_BEZIER_SHORT","CUBIC_BEZIER_SHORT_R","QUAD_BEZIER","QUAD_BEZIER_R","QUAD_BEZIER_SHORT","QUAD_BEZIER_SHORT_R","ARC","ARC_R","STROKE_WIDTH","STROKE_WIDTH_R","STROKE_WIDTH_BEZIER","STROKE_WIDTH_BEZIER_R","fill","cap","BUTT","BEVEL","miter","instruction","alpha","fillStyle","toCSS","Path2D","strokeStyle","ROUND","PROJECTING","MITER","red","green","blue","EventEmitter","onPointerDown","e","isDown","points","offsetX","offsetY","pressure","previewStroke","size","emit","onPointerMove","event","getCoalescedEvents","getCurrentLength","onPointerUp","splice","indexOf","eventTarget","addEventListener","unbind","removeEventListener","lastPoint","Math","hypot"],"mappings":"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CA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA,eAAe,SAAS;AACxB;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA,GAAG;AACH,oBAAoB,SAAS;AAC7B;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA,KAAK;AACL;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA","file":"graphein.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 3);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap 70634ce2f86c6d617ccb","const Transform = require('./transform')\n\nmodule.exports = class Layer {\n  constructor () {\n    this.type = Layer.types.GROUP\n    this.transform = new Transform()\n    this.children = []\n  }\n\n  serialize () {\n    return {\n      type: this.type,\n      transform: this.transform.serialize(),\n      children: this.children.map(child => child.serialize())\n    }\n  }\n\n  render (ctx) {\n    ctx.save()\n    this.transform.render(ctx)\n    this.children.forEach(child => child.render(ctx))\n    ctx.restore()\n  }\n\n  static types = {\n    GROUP: 'g',\n    PATH: 'p',\n    CLIPPING_MASK: 'c',\n    RECTANGLE: 'sr',\n    CIRCLE: 'sc',\n    TEXT: 't',\n    RASTER_IMAGE: 'b'\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/layer.js","const Layer = require('./layer')\n\nmodule.exports = class Image extends Layer {\n  constructor () {\n    super()\n\n    // TODO: don't hardcode\n    this.version = 0\n    this.width = 100\n    this.height = 100\n  }\n\n  serialize () {\n    return {\n      version: this.version,\n      w: this.width,\n      h: this.height,\n      c: this.children.map(child => child.serialize())\n    }\n  }\n\n  render (ctx) {\n    ctx.clearRect(0, 0, this.width, this.height)\n    ctx.save()\n    ctx.beginPath()\n    ctx.rect(0, 0, this.width, this.height)\n    ctx.clip()\n    this.children.forEach(child => child.render(ctx))\n    ctx.restore()\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/image.js","module.exports = class Transform {\n  constructor () {\n    this.type = Transform.types.NONE\n    this.data = new Float32Array([])\n  }\n\n  serialize () {\n    return this.data\n  }\n\n  render (ctx) {\n    if (this.type === Transform.types.MAT3) {\n      ctx.transform(...this.data)\n    } else if (this.type == Transform.types.MAT4) {\n      console.warn('Cannot properly render Mat4 on canvas')\n      ctx.transform(this.data[0], this.data[1], this.data[3], this.data[4], this.data[9], this.data[10])\n    }\n  }\n\n  static deserialize (data) {\n    let transform = new Transform()\n    transform.type = data.length === 12\n      ? Transform.types.MAT4\n      : data.length === 6\n      ? Transform.types.MAT3\n      : Transform.types.NONE\n    transform.data = new Float32Array(data.slice())\n    return transform\n  }\n\n  static types = {\n    NONE: 0,\n    MAT3: 1,\n    MAT4: 2\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/transform.js","const Canvas = require('./canvas')\nconst Image = require('./image')\nconst Layer = require('./layer')\nconst Transform = require('./transform')\nconst Path = require('./path')\n\nconst graphein = {\n  Canvas,\n  Image,\n  Layer,\n  Transform,\n  Path\n}\n\nmodule.exports = window.graphein = graphein\n\n\n\n// WEBPACK FOOTER //\n// ./src/index.js","const Image = require('./image')\nconst Brush = require('./brush')\n\nclass Canvas extends window.HTMLElement {\n  constructor () {\n    super()\n\n    this.canvas = document.createElement('canvas')\n    this.ctx = this.canvas.getContext('2d')\n\n    this.brush = new Brush()\n    this.brush.bind(this.canvas)\n\n    this._image = new Image()\n    this.brush.previewLayer = this._image\n    this.brush.on('update', () => this.render())\n  }\n\n  connectedCallback () {\n    if (!this._didInit) {\n      this._didInit = true\n      this.appendChild(this.canvas)\n    }\n  }\n\n  get image () {\n    return this._image\n  }\n\n  set image (v) {\n    this._image = v\n    this.brush.previewLayer = v\n    this.render()\n  }\n\n  render () {\n    let start = performance.now()\n    this.image.render(this.ctx)\n    let end = performance.now()\n    console.log(`Rendered in ${end - start}ms`)\n  }\n}\n\nwindow.customElements.define('graphein-canvas', Canvas)\nmodule.exports = Canvas\n\n\n\n// WEBPACK FOOTER //\n// ./src/canvas.js","const Layer = require('./layer')\nconst Color = require('./color')\n\n// TODO: redo properly\n\n// reuse svg elements\nlet basePath = document.createElementNS('http://www.w3.org/2000/svg', 'path')\nlet widthL = document.createElementNS('http://www.w3.org/2000/svg', 'path')\nlet widthR = document.createElementNS('http://www.w3.org/2000/svg', 'path')\n\nclass StrokeRenderer {\n  constructor () {\n    this.path = []\n    this.widthL = [['M', 0, 0]]\n    this.widthR = [['M', 0, 0]]\n    this.cursor = [0, 0]\n    this.cursorL = [0, 0]\n    this.cursorR = [0, 0]\n  }\n\n  add (type, ...args) {\n    if (type.startsWith('_')) {\n      type = type.substr(1)\n      if (type === 'L') {\n        this.cursorL = [args[0], args[1]]\n        this.cursorR = [args[0], args[2]]\n        this.widthL.push([type, ...this.cursorL])\n        this.widthR.push([type, ...this.cursorR])\n      } else if (type === 'l') {\n        this.cursorL[0] += args[0]\n        this.cursorR[0] += args[0]\n        this.cursorL[1] += args[1]\n        this.cursorR[1] += args[2]\n        this.widthL.push([type, ...this.cursorL])\n        this.widthR.push([type, ...this.cursorR])\n      } else if (type === 'C') {\n        let leftArgs = args.slice(1, 5).concat([args[0], args[5]])\n        let rightArgs = args.slice(6, 10).concat([args[0], args[10]])\n        this.cursorL = [args[0], args[5]]\n        this.cursorR = [args[0], args[10]]\n        this.widthL.push(['C', ...leftArgs])\n        this.widthR.push(['C', ...rightArgs])\n      }\n      // TODO: c\n    } else {\n      this.path.push([type, ...args])\n    }\n  }\n\n  getPath () {\n    return this.path.map(item => item.join(' ')).join(' ')\n  }\n\n  getWidthL () {\n    return this.widthL.map(item => item.join(' ')).join(' ')\n  }\n\n  getWidthR () {\n    return this.widthR.map(item => item.join(' ')).join(' ')\n  }\n\n  render (ctx) {\n    basePath.setAttribute('d', this.getPath())\n    widthL.setAttribute('d', this.getWidthL())\n    widthR.setAttribute('d', this.getWidthR())\n\n    let baseLength = basePath.getTotalLength()\n    let resolution = 1 / window.devicePixelRatio\n\n    let cursor = null\n    let currentL = 0\n    let currentR = 0\n\n    let findNextPointAtX = (path, target, start = 0) => {\n      let x = start\n      let length = path.getTotalLength()\n\n      while (true) {\n        if (x > length) return length\n        if (path.getPointAtLength(x).x >= target) {\n          return x\n        }\n        x += resolution\n      }\n    }\n\n    let lastLeftPos = 0\n    let lastRightPos = 0\n\n    for (let x = 0; x < baseLength; x += resolution) {\n      let point = basePath.getPointAtLength(x)\n\n      let leftPos = findNextPointAtX(widthL, x, lastLeftPos)\n      let rightPos = findNextPointAtX(widthR, x, lastRightPos)\n\n      let left = widthL.getPointAtLength(leftPos).y\n      let right = widthR.getPointAtLength(rightPos).y\n\n      // TODO: support jumps (M/m) midway\n\n      if (!cursor) {\n        ctx.beginPath()\n        ctx.moveTo(point.x, point.y)\n        cursor = [point.x, point.y]\n      }\n\n      if (left !== currentL || right !== currentR) {\n        currentL = left\n        currentR = right\n\n        // TODO: support asymmetry\n        ctx.stroke()\n        ctx.lineWidth = (currentL + currentR) / 2 // average for now\n        ctx.beginPath()\n        ctx.moveTo(...cursor)\n      }\n\n      ctx.lineTo(point.x, point.y)\n      cursor = [point.x, point.y]\n    }\n\n    ctx.stroke()\n  }\n}\n\nconst instructionFunctions = {\n  0x00: 'Z',\n  0x10: 'M',\n  0x11: 'm',\n  0x20: 'L',\n  0x21: 'l',\n  0x30: 'C',\n  0x31: 'c',\n  0x32: 'S',\n  0x33: 's',\n  0x40: 'Q',\n  0x41: 'q',\n  0x42: 'T',\n  0x43: 't',\n  0x50: 'A',\n  0x51: 'a',\n  0x60: '_L',\n  0x61: '_l',\n  0x62: '_C',\n  0x63: '_c'\n}\n\nclass Instruction {\n  constructor (type, ...data) {\n    this.type = type | 0\n    this.data = data || []\n  }\n\n  render (renderer) {\n    renderer.add(instructionFunctions[this.type], ...this.data)\n  }\n\n  serialize () {\n    return [this.type, this.data]\n  }\n\n  static types = {\n    CLOSE_PATH: 0,\n    MOVE: 0x10,\n    MOVE_R: 0x11,\n    LINE: 0x20,\n    LINE_R: 0x21,\n    CUBIC_BEZIER: 0x30,\n    CUBIC_BEZIER_R: 0x31,\n    CUBIC_BEZIER_SHORT: 0x32,\n    CUBIC_BEZIER_SHORT_R: 0x33,\n    QUAD_BEZIER: 0x40,\n    QUAD_BEZIER_R: 0x41,\n    QUAD_BEZIER_SHORT: 0x42,\n    QUAD_BEZIER_SHORT_R: 0x43,\n    ARC: 0x50,\n    ARC_R: 0x51,\n    STROKE_WIDTH: 0x60,\n    STROKE_WIDTH_R: 0x61,\n    STROKE_WIDTH_BEZIER: 0x62,\n    STROKE_WIDTH_BEZIER_R: 0x63\n  }\n}\n\nmodule.exports = class Path extends Layer {\n  constructor () {\n    super()\n\n    this.stroke = new Color()\n    this.fill = new Color()\n    this.cap = Path.cap.BUTT\n    this.join = Path.join.BEVEL\n    this.miter = 0\n    this.data = []\n  }\n\n  render (ctx) {\n    let renderer = new StrokeRenderer()\n    this.data.forEach(instruction => instruction.render(renderer))\n\n    if (this.fill.alpha) {\n      ctx.fillStyle = this.fill.toCSS()\n      ctx.fill(new window.Path2D(renderer.getPath()))\n    }\n    if (this.stroke.alpha) {\n      ctx.strokeStyle = this.stroke.toCSS()\n      renderer.render(ctx)\n    }\n  }\n\n  static cap = {\n    BUTT: 0,\n    ROUND: 1,\n    PROJECTING: 2\n  }\n\n  static join = {\n    BEVEL: 0,\n    ROUND: 1,\n    MITER: 2\n  }\n\n  static Instruction = Instruction\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/path.js","module.exports = class Color {\n  constructor () {\n    this.alpha = 0\n    this.red = 0\n    this.green = 0\n    this.blue = 0\n  }\n\n  toCSS () {\n    return `rgba(${this.red * 255}, ${this.green * 255}, ${this.blue * 255}, ${this.alpha})`\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/color.js","const EventEmitter = require('events')\nconst Path = require('./path')\n\n// TODO: pen tilt\n\nmodule.exports = class Brush extends EventEmitter {\n  constructor () {\n    super()\n\n    this.eventTarget = null\n    this.previewLayer = null\n\n    this.size = 10\n\n    this.isDown = false\n    this.points = []\n    this.previewStroke = null\n  }\n\n  bind (target) {\n    if (this.eventTarget) console.warn('Binding brush to multiple elements')\n    this.eventTarget = target\n\n    target.addEventListener('pointerdown', this.onPointerDown)\n    target.addEventListener('pointermove', this.onPointerMove)\n    target.addEventListener('pointerup', this.onPointerUp)\n  }\n\n  unbind () {\n    this.eventTarget.removeEventListener('pointerdown', this.onPointerDown)\n    this.eventTarget.removeEventListener('pointermove', this.onPointerMove)\n    this.eventTarget.removeEventListener('pointerup', this.onPointerUp)\n  }\n\n  stroke () {\n\n  }\n\n  getCurrentLength () {\n    let length = 0\n    let lastPoint = [0, 0]\n    for (let instruction of this.previewStroke.data) {\n      if (instruction.type === 0x10) {\n        lastPoint = instruction.data\n      } else if (instruction.type === 0x20) {\n        length += Math.hypot(instruction.data[0] - lastPoint[0], instruction.data[1] - lastPoint[1])\n        lastPoint = instruction.data\n      }\n    }\n    return length\n  }\n\n  onPointerDown = e => {\n    this.isDown = true\n    this.points = []\n    this.points.push({\n      x: e.offsetX,\n      y: e.offsetY,\n      pressure: e.pressure\n    })\n    this.previewStroke = new Path()\n    this.previewStroke.stroke.alpha = 1\n    this.previewStroke.data.push(new Path.Instruction(0x10, e.offsetX, e.offsetY))\n    this.previewStroke.data.push(new Path.Instruction(0x60, 0, e.pressure * this.size / 2, e.pressure * this.size / 2))\n    if (this.previewLayer) this.previewLayer.children.push(this.previewStroke)\n    this.emit('update')\n  }\n\n  onPointerMove = e => {\n    if (!this.isDown) return\n\n    for (let event in e.getCoalescedEvents().concat(e)) {\n      this.points.push({\n        x: e.offsetX,\n        y: e.offsetY,\n        pressure: e.pressure\n      })\n\n      this.previewStroke.data.push(new Path.Instruction(0x20, e.offsetX, e.offsetY))\n    this.previewStroke.data.push(new Path.Instruction(0x60, this.getCurrentLength(), e.pressure * this.size / 2, e.pressure * this.size / 2))\n    }\n    this.emit('update')\n  }\n\n  onPointerUp = e => {\n    this.isDown = false\n    this.points.push({\n      x: e.offsetX,\n      y: e.offsetY,\n      pressure: e.pressure\n    })\n\n    this.previewStroke.data.push(new Path.Instruction(0x20, e.offsetX, e.offsetY))\n    this.previewStroke.data.push(new Path.Instruction(0x60, this.getCurrentLength(), e.pressure * this.size / 2, e.pressure * this.size / 2))\n\n    if (this.previewLayer) {\n      this.previewLayer.children.splice(this.previewLayer.children.indexOf(this.previewStroke), 1)\n    }\n\n    console.log(this.previewStroke)\n\n    this.stroke()\n\n    this.emit('update')\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/brush.js","// Copyright Joyent, Inc. and other Node contributors.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a\n// copy of this software and associated documentation files (the\n// \"Software\"), to deal in the Software without restriction, including\n// without limitation the rights to use, copy, modify, merge, publish,\n// distribute, sublicense, and/or sell copies of the Software, and to permit\n// persons to whom the Software is furnished to do so, subject to the\n// following conditions:\n//\n// The above copyright notice and this permission notice shall be included\n// in all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS\n// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF\n// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN\n// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,\n// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR\n// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE\n// USE OR OTHER DEALINGS IN THE SOFTWARE.\n\nfunction EventEmitter() {\n  this._events = this._events || {};\n  this._maxListeners = this._maxListeners || undefined;\n}\nmodule.exports = EventEmitter;\n\n// Backwards-compat with node 0.10.x\nEventEmitter.EventEmitter = EventEmitter;\n\nEventEmitter.prototype._events = undefined;\nEventEmitter.prototype._maxListeners = undefined;\n\n// By default EventEmitters will print a warning if more than 10 listeners are\n// added to it. This is a useful default which helps finding memory leaks.\nEventEmitter.defaultMaxListeners = 10;\n\n// Obviously not all Emitters should be limited to 10. This function allows\n// that to be increased. Set to zero for unlimited.\nEventEmitter.prototype.setMaxListeners = function(n) {\n  if (!isNumber(n) || n < 0 || isNaN(n))\n    throw TypeError('n must be a positive number');\n  this._maxListeners = n;\n  return this;\n};\n\nEventEmitter.prototype.emit = function(type) {\n  var er, handler, len, args, i, listeners;\n\n  if (!this._events)\n    this._events = {};\n\n  // If there is no 'error' event listener then throw.\n  if (type === 'error') {\n    if (!this._events.error ||\n        (isObject(this._events.error) && !this._events.error.length)) {\n      er = arguments[1];\n      if (er instanceof Error) {\n        throw er; // Unhandled 'error' event\n      } else {\n        // At least give some kind of context to the user\n        var err = new Error('Uncaught, unspecified \"error\" event. (' + er + ')');\n        err.context = er;\n        throw err;\n      }\n    }\n  }\n\n  handler = this._events[type];\n\n  if (isUndefined(handler))\n    return false;\n\n  if (isFunction(handler)) {\n    switch (arguments.length) {\n      // fast cases\n      case 1:\n        handler.call(this);\n        break;\n      case 2:\n        handler.call(this, arguments[1]);\n        break;\n      case 3:\n        handler.call(this, arguments[1], arguments[2]);\n        break;\n      // slower\n      default:\n        args = Array.prototype.slice.call(arguments, 1);\n        handler.apply(this, args);\n    }\n  } else if (isObject(handler)) {\n    args = Array.prototype.slice.call(arguments, 1);\n    listeners = handler.slice();\n    len = listeners.length;\n    for (i = 0; i < len; i++)\n      listeners[i].apply(this, args);\n  }\n\n  return true;\n};\n\nEventEmitter.prototype.addListener = function(type, listener) {\n  var m;\n\n  if (!isFunction(listener))\n    throw TypeError('listener must be a function');\n\n  if (!this._events)\n    this._events = {};\n\n  // To avoid recursion in the case that type === \"newListener\"! Before\n  // adding it to the listeners, first emit \"newListener\".\n  if (this._events.newListener)\n    this.emit('newListener', type,\n              isFunction(listener.listener) ?\n              listener.listener : listener);\n\n  if (!this._events[type])\n    // Optimize the case of one listener. Don't need the extra array object.\n    this._events[type] = listener;\n  else if (isObject(this._events[type]))\n    // If we've already got an array, just append.\n    this._events[type].push(listener);\n  else\n    // Adding the second element, need to change to array.\n    this._events[type] = [this._events[type], listener];\n\n  // Check for listener leak\n  if (isObject(this._events[type]) && !this._events[type].warned) {\n    if (!isUndefined(this._maxListeners)) {\n      m = this._maxListeners;\n    } else {\n      m = EventEmitter.defaultMaxListeners;\n    }\n\n    if (m && m > 0 && this._events[type].length > m) {\n      this._events[type].warned = true;\n      console.error('(node) warning: possible EventEmitter memory ' +\n                    'leak detected. %d listeners added. ' +\n                    'Use emitter.setMaxListeners() to increase limit.',\n                    this._events[type].length);\n      if (typeof console.trace === 'function') {\n        // not supported in IE 10\n        console.trace();\n      }\n    }\n  }\n\n  return this;\n};\n\nEventEmitter.prototype.on = EventEmitter.prototype.addListener;\n\nEventEmitter.prototype.once = function(type, listener) {\n  if (!isFunction(listener))\n    throw TypeError('listener must be a function');\n\n  var fired = false;\n\n  function g() {\n    this.removeListener(type, g);\n\n    if (!fired) {\n      fired = true;\n      listener.apply(this, arguments);\n    }\n  }\n\n  g.listener = listener;\n  this.on(type, g);\n\n  return this;\n};\n\n// emits a 'removeListener' event iff the listener was removed\nEventEmitter.prototype.removeListener = function(type, listener) {\n  var list, position, length, i;\n\n  if (!isFunction(listener))\n    throw TypeError('listener must be a function');\n\n  if (!this._events || !this._events[type])\n    return this;\n\n  list = this._events[type];\n  length = list.length;\n  position = -1;\n\n  if (list === listener ||\n      (isFunction(list.listener) && list.listener === listener)) {\n    delete this._events[type];\n    if (this._events.removeListener)\n      this.emit('removeListener', type, listener);\n\n  } else if (isObject(list)) {\n    for (i = length; i-- > 0;) {\n      if (list[i] === listener ||\n          (list[i].listener && list[i].listener === listener)) {\n        position = i;\n        break;\n      }\n    }\n\n    if (position < 0)\n      return this;\n\n    if (list.length === 1) {\n      list.length = 0;\n      delete this._events[type];\n    } else {\n      list.splice(position, 1);\n    }\n\n    if (this._events.removeListener)\n      this.emit('removeListener', type, listener);\n  }\n\n  return this;\n};\n\nEventEmitter.prototype.removeAllListeners = function(type) {\n  var key, listeners;\n\n  if (!this._events)\n    return this;\n\n  // not listening for removeListener, no need to emit\n  if (!this._events.removeListener) {\n    if (arguments.length === 0)\n      this._events = {};\n    else if (this._events[type])\n      delete this._events[type];\n    return this;\n  }\n\n  // emit removeListener for all listeners on all events\n  if (arguments.length === 0) {\n    for (key in this._events) {\n      if (key === 'removeListener') continue;\n      this.removeAllListeners(key);\n    }\n    this.removeAllListeners('removeListener');\n    this._events = {};\n    return this;\n  }\n\n  listeners = this._events[type];\n\n  if (isFunction(listeners)) {\n    this.removeListener(type, listeners);\n  } else if (listeners) {\n    // LIFO order\n    while (listeners.length)\n      this.removeListener(type, listeners[listeners.length - 1]);\n  }\n  delete this._events[type];\n\n  return this;\n};\n\nEventEmitter.prototype.listeners = function(type) {\n  var ret;\n  if (!this._events || !this._events[type])\n    ret = [];\n  else if (isFunction(this._events[type]))\n    ret = [this._events[type]];\n  else\n    ret = this._events[type].slice();\n  return ret;\n};\n\nEventEmitter.prototype.listenerCount = function(type) {\n  if (this._events) {\n    var evlistener = this._events[type];\n\n    if (isFunction(evlistener))\n      return 1;\n    else if (evlistener)\n      return evlistener.length;\n  }\n  return 0;\n};\n\nEventEmitter.listenerCount = function(emitter, type) {\n  return emitter.listenerCount(type);\n};\n\nfunction isFunction(arg) {\n  return typeof arg === 'function';\n}\n\nfunction isNumber(arg) {\n  return typeof arg === 'number';\n}\n\nfunction isObject(arg) {\n  return typeof arg === 'object' && arg !== null;\n}\n\nfunction isUndefined(arg) {\n  return arg === void 0;\n}\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./node_modules/events/events.js\n// module id = 8\n// module chunks = 0"],"sourceRoot":""}